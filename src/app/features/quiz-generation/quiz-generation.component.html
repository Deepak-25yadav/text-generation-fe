<section class="container">
  <h1>Quiz Generation</h1>

  <form (ngSubmit)="onSubmit()" *ngIf="!quiz()">
    <div class="form-group">
      <label for="title">Title *</label>
      <input
        id="title"
        type="text"
        [ngModel]="title()"
        (ngModelChange)="title.set($event)"
        name="title"
        placeholder="Enter quiz title"
        required>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        [ngModel]="description()"
        (ngModelChange)="description.set($event)"
        name="description"
        rows="3"
        placeholder="Enter quiz description or topic">
      </textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="numberOfQuestions">Number of Questions</label>
        <input
          id="numberOfQuestions"
          type="number"
          [ngModel]="numberOfQuestions()"
          (ngModelChange)="numberOfQuestions.set(+$event)"
          name="numberOfQuestions"
          min="1"
          max="20"
          required>
      </div>

      <div class="form-group">
        <label for="difficulty">Difficulty</label>
        <select
          id="difficulty"
          [ngModel]="difficulty()"
          (ngModelChange)="difficulty.set($event)"
          name="difficulty">
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>
      </div>

      <div class="form-group">
        <label for="questionType">Question Type</label>
        <select
          id="questionType"
          [ngModel]="questionType()"
          (ngModelChange)="questionType.set($event)"
          name="questionType">
          <option value="multiple-choice">Multiple Choice</option>
          <option value="true-false">True/False</option>
          <option value="short-answer">Short Answer</option>
        </select>
      </div>
    </div>

    <button type="submit" [disabled]="loading()">
      {{ loading() ? 'Generating Quiz...' : 'Generate Quiz' }}
    </button>
  </form>

  <div class="error" *ngIf="error()">
    <p>{{ error() }}</p>
  </div>

  <div class="quiz-container" *ngIf="quiz()">
    <div class="quiz-header">
      <h2>{{ quiz()!.title }}</h2>
      <p *ngIf="quiz()!.description" class="quiz-description">{{ quiz()!.description }}</p>
      <div class="quiz-meta">
        <span>Total Points: {{ quiz()!.totalPoints }}</span>
        <span>Difficulty: {{ quiz()!.difficulty }}</span>
        <span>Questions: {{ quiz()!.questions.length }}</span>
      </div>
    </div>

    <div class="questions-container" *ngIf="!showResults()">
      <div class="question-card" *ngFor="let question of quiz()!.questions; let i = index">
        <div class="question-header">
          <span class="question-number">Question {{ i + 1 }}</span>
          <span class="question-points">{{ question.points }} point{{ question.points !== 1 ? 's' : '' }}</span>
        </div>
        <p class="question-text">{{ question.question }}</p>
        
        <div class="options-container">
          <label
            *ngFor="let option of question.options"
            class="option-label"
            [class.selected]="getSelectedAnswer(i) === option">
            <input
              type="radio"
              [name]="'question-' + i"
              [value]="option"
              [checked]="getSelectedAnswer(i) === option"
              (change)="selectAnswer(i, option)">
            <span>{{ option }}</span>
          </label>
        </div>

        <div class="question-footer" *ngIf="question.tags && question.tags.length > 0">
          <div class="tags">
            <span *ngFor="let tag of question.tags" class="tag">{{ tag }}</span>
          </div>
        </div>
      </div>

      <div class="quiz-actions">
        <button type="button" class="btn-submit" (click)="submitQuiz()">
          Submit Quiz
        </button>
        <button type="button" class="btn-reset" (click)="resetQuiz()">
          Reset Answers
        </button>
      </div>
    </div>

    <div class="results-container" *ngIf="showResults()">
      <div class="score-card">
        <h3>Quiz Results</h3>
        <div class="score-display">
          <div class="score-circle">
            <span class="score-percentage">{{ getScore().percentage }}%</span>
          </div>
          <p class="score-text">
            You got {{ getScore().correct }} out of {{ getScore().total }} questions correct!
          </p>
        </div>
      </div>

      <div class="questions-review">
        <div
          class="question-card review"
          *ngFor="let question of quiz()!.questions; let i = index"
          [class.correct]="isCorrect(question, getSelectedAnswer(i))"
          [class.incorrect]="!isCorrect(question, getSelectedAnswer(i)) && getSelectedAnswer(i)">
          <div class="question-header">
            <span class="question-number">Question {{ i + 1 }}</span>
            <span class="result-badge" [class.correct]="isCorrect(question, getSelectedAnswer(i))">
              {{ isCorrect(question, getSelectedAnswer(i)) ? '✓ Correct' : '✗ Incorrect' }}
            </span>
          </div>
          <p class="question-text">{{ question.question }}</p>
          
          <div class="options-review">
            <div
              *ngFor="let option of question.options"
              class="option-review"
              [class.correct-answer]="option === question.correctAnswer"
              [class.selected-answer]="option === getSelectedAnswer(i) && option !== question.correctAnswer">
              <span class="option-text">{{ option }}</span>
              <span class="option-indicator" *ngIf="option === question.correctAnswer">✓ Correct Answer</span>
              <span class="option-indicator wrong" *ngIf="option === getSelectedAnswer(i) && option !== question.correctAnswer">✗ Your Answer</span>
            </div>
          </div>

          <div class="explanation" *ngIf="question.explanation">
            <strong>Explanation:</strong> {{ question.explanation }}
          </div>
        </div>
      </div>

      <div class="quiz-actions">
        <button type="button" class="btn-reset" (click)="resetQuiz()">
          Try Again
        </button>
        <button type="button" class="btn-generate" (click)="generateNewQuiz()">
          Generate New Quiz
        </button>
      </div>
    </div>
  </div>
</section>

